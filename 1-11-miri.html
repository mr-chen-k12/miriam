<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habitat Heroes: Study Game</title>
    <style>
        :root {
            --primary: #4A90E2;       /* Blue */
            --secondary: #48BB78;     /* Green */
            --wrong: #E53E3E;         /* Red */
            --accent: #ED8936;        /* Orange */
            --text: #2D3748;
            --bg: #F7FAFC;
            
            --set1-color: #4299E1; 
            --set2-color: #48BB78; 
            --set3-color: #ED8936; 
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 600px;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }

        /* --- MENU STYLES --- */
        h1 { margin: 0 0 10px 0; color: var(--primary); }
        .subtitle { color: #718096; margin-bottom: 30px; }

        .menu-grid { display: grid; gap: 15px; margin-top: 10px; }

        .level-card {
            padding: 20px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
            text-align: left;
            width: 100%;
        }
        .level-card:hover { transform: scale(1.02); }

        .set-1 { background: linear-gradient(135deg, #4299E1, #63B3ED); }
        .set-2 { background: linear-gradient(135deg, #48BB78, #68D391); }
        .set-3 { background: linear-gradient(135deg, #ED8936, #F6AD55); }

        .level-title { font-size: 1.2rem; font-weight: bold; display: block; }
        .level-desc { font-size: 0.85rem; opacity: 0.9; }
        .level-icon { font-size: 2rem; }

        /* --- QUIZ STYLES --- */
        .top-bar { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: #A0AEC0; font-size: 0.9rem; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #EDF2F7;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--secondary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-box {
            background-color: #EBF8FF;
            border: 3px solid var(--primary);
            color: #2C5282;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
            line-height: 1.4;
        }

        .options-grid { display: grid; gap: 10px; }

        button.option-btn {
            background: white;
            border: 2px solid #E2E8F0;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text);
            font-weight: 600;
            width: 100%;
            transition: all 0.2s;
        }
        button.option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: #F7FAFC;
            transform: translateY(-2px);
        }

        /* Answer States */
        button.correct { background-color: var(--secondary); border-color: #2F855A; color: white; }
        button.wrong { background-color: var(--wrong); border-color: #9B2C2C; color: white; opacity: 0.6; }

        /* "I Don't Know" Button */
        .idk-btn {
            margin-top: 15px;
            background: none;
            border: none;
            color: #718096;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .idk-btn:hover { color: var(--primary); }

        /* Feedback Box */
        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            display: none; /* Hidden by default */
        }
        .fb-correct { background-color: #C6F6D5; color: #22543D; border: 1px solid #9AE6B4; }
        .fb-wrong { background-color: #FED7D7; color: #822727; border: 1px solid #FEB2B2; }

        /* Navigation Buttons */
        .next-btn, .home-btn, .review-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            margin-top: 15px;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .next-btn:hover { background-color: #3182CE; }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="container">
        
        <div id="menu-screen">
            <h1>ü¶Å Habitat Heroes</h1>
            <p class="subtitle">Pick a card set to start studying!</p>
            
            <div class="menu-grid">
                <button class="level-card set-1" onclick="startLevel(1)">
                    <div>
                        <span class="level-title">Set 1: Key Words</span>
                        <span class="level-desc">Habitat, Ecosystem, Survival...</span>
                    </div>
                    <div class="level-icon">üìö</div>
                </button>

                <button class="level-card set-2" onclick="startLevel(2)">
                    <div>
                        <span class="level-title">Set 2: Animals</span>
                        <span class="level-desc">Adaptations & Groups</span>
                    </div>
                    <div class="level-icon">üêò</div>
                </button>

                <button class="level-card set-3" onclick="startLevel(3)">
                    <div>
                        <span class="level-title">Set 3: Earth & History</span>
                        <span class="level-desc">Fossils & Human Impact</span>
                    </div>
                    <div class="level-icon">üåç</div>
                </button>
            </div>
        </div>

        <div id="quiz-screen" class="hidden">
            <div class="top-bar">
                <span id="level-indicator">Set 1</span>
                <span id="score-indicator">0/0</span>
            </div>
            
            <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
            
            <div id="question-text" class="question-box">Loading...</div>
            
            <div id="options-container" class="options-grid">
                </div>

            <button id="idk-btn" class="idk-btn" onclick="handleIdk()">I don't know this one ü§î</button>
            
            <div id="feedback" class="feedback-box"></div>
            
            <button id="next-btn" class="next-btn hidden" onclick="nextQuestion()">Next Question ‚û°Ô∏è</button>
        </div>

        <div id="end-screen" class="hidden">
            <h1 id="end-title">Set Complete! üéâ</h1>
            
            <div style="background: #EDF2F7; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p>‚úÖ Correct: <strong id="final-correct" style="color: green;">0</strong></p>
                <p>‚ùå Needs Practice: <strong id="final-wrong" style="color: #E53E3E;">0</strong></p>
            </div>
            
            <div id="review-section" class="hidden">
                <p>You missed a few! Let's fix that.</p>
                <button class="next-btn" style="background-color: var(--accent);" onclick="startReviewRound()">üß† Review Mistakes</button>
            </div>
            
            <button id="home-btn" class="home-btn" style="background-color: #718096; margin-top:10px;" onclick="goToMenu()">üè† Back to Menu</button>
        </div>

    </div>

<script>
    // --- DATA ---
    const quizSets = {
        1: [ // VOCAB
            { type: 'vocab', answer: "Habitat", question: "The natural place where an organism lives." },
            { type: 'vocab', answer: "Survive", question: "To stay alive." },
            { type: 'vocab', answer: "Ecosystem", question: "All the living and nonliving things in a place and their interactions." },
            { type: 'vocab', answer: "Natural Hazard", question: "A natural event that causes negative changes to a habitat or ecosystem." },
            { type: 'vocab', answer: "Invasive Species", question: "An organism that causes harm in a place where it does not normally live." },
            { type: 'vocab', answer: "Overpopulation", question: "When there are too many of one kind of species in an ecosystem." },
            { type: 'vocab', answer: "Migrate", question: "To move from one place to another in different seasons." },
            { type: 'vocab', answer: "Climate", question: "The pattern of weather over a long period of time." },
            { type: 'vocab', answer: "Respond", question: "To react to a change by doing something." },
            { type: 'vocab', answer: "Conserve", question: "To protect from harm (Conservation)." },
            { type: 'vocab', answer: "Restoration", question: "To bring back something; repairing damage done by nature or people." },
            { type: 'vocab', answer: "Evidence", question: "Information that supports an argument." },
            { type: 'vocab', answer: "Preserve", question: "To keep something in its original form." },
            { type: 'vocab', answer: "Extinct", question: "Having no surviving members." },
            { type: 'vocab', answer: "Endangered Species", question: "A species that is at risk of becoming extinct within a few years." }
        ],
        2: [ // ANIMALS
            { type: 'group', answer: "Pride", question: "A group of Lions is called a..." },
            { type: 'group', answer: "Pod", question: "A group of Dolphins is called a..." },
            { type: 'group', answer: "School", question: "A group of Fish is called a..." },
            { type: 'group', answer: "Herd", question: "A group of Wildebeests and Elephants is called a..." },
            { type: 'group', answer: "Mob", question: "A group of Meerkats is called a..." },
            { type: 'adapt', answer: "Gills", question: "Adaptation: How fish breathe." },
            { type: 'adapt', answer: "Oily Feathers", question: "Adaptation: Makes ducks waterproof." },
            { type: 'adapt', answer: "Long Necks", question: "Adaptation: Helps giraffes reach tops of trees for food." },
            { type: 'adapt', answer: "Large Eyes", question: "Adaptation: Helps owls see at night." },
            { type: 'adapt', answer: "Blubber", question: "Adaptation: Helps walruses keep warm in cold temperatures." },
            { type: 'vocab', answer: "Adaptation", question: "A body part or behavior that helps a living thing survive." },
            { type: 'vocab', answer: "Behavioral Trait", question: "A way an organism behaves, or acts." }
        ],
        3: [ // EARTH
            { type: 'impact', answer: "Cutting down trees", question: "Human Impact: Removes food and shelter sources for certain organisms." },
            { type: 'impact', answer: "Road construction", question: "Human Impact: Removes rainforests and animals may be killed trying to cross." },
            { type: 'impact', answer: "Building Dams", question: "Human Impact: These can block rivers that salmon depend on for migration." },
            { type: 'impact', answer: "Collecting fresh water", question: "Human Impact: Removing this from rivers/lakes can dry them up, hurting organisms." },
            { type: 'impact', answer: "Global Warming", question: "Caused by burning materials; traps gas in atmosphere and melts Arctic ice." },
            { type: 'fossil', answer: "Fossil", question: "The remains of a living thing from long ago, usually formed in layers of rock." },
            { type: 'fossil', answer: "Mud", question: "Step 2 of Fossils: After a plant/animal dies, it must be covered in this." },
            { type: 'fossil', answer: "Minerals", question: "These replace the hard parts of an animal to form a fossil." },
            { type: 'fossil', answer: "Permafrost", question: "Woolly Mammoths are often preserved in this frozen ground." },
            { type: 'fossil', answer: "Amber", question: "Insects like ants and mosquitoes are often preserved in this." },
            { type: 'vocab', answer: "Decompose", question: "To break down and become part of the environment." }
        ]
    };

    const allData = [...quizSets[1], ...quizSets[2], ...quizSets[3]];

    // --- VARIABLES ---
    let currentQueue = [];
    let missedQueue = [];
    let currentIndex = 0;
    
    // --- ELEMENTS ---
    const menuScreen = document.getElementById('menu-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const endScreen = document.getElementById('end-screen');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedbackBox = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');
    const idkBtn = document.getElementById('idk-btn');
    const progressBar = document.getElementById('progress-fill');
    
    // --- LOGIC ---

    function shuffle(array) {
        // Fisher-Yates Shuffle
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function goToMenu() {
        quizScreen.classList.add('hidden');
        endScreen.classList.add('hidden');
        menuScreen.classList.remove('hidden');
    }

    function startLevel(setNum) {
        currentQueue = shuffle([...quizSets[setNum]]);
        missedQueue = [];
        currentIndex = 0;
        
        // Colors
        let color = setNum === 1 ? 'var(--set1-color)' : (setNum === 2 ? 'var(--set2-color)' : 'var(--set3-color)');
        document.querySelector('.question-box').style.borderColor = color;
        document.getElementById('level-indicator').innerText = "Set " + setNum;

        menuScreen.classList.add('hidden');
        endScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        
        loadQuestion();
    }

    function startReviewRound() {
        currentQueue = shuffle([...missedQueue]);
        missedQueue = [];
        currentIndex = 0;
        
        endScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        document.getElementById('level-indicator').innerText = "Review Mode";
        
        loadQuestion();
    }

    function getDistractors(correctItem) {
        // Find wrong answers (preferably same type)
        let pool = allData.filter(item => item.type === correctItem.type && item.answer !== correctItem.answer);
        if (pool.length < 3) pool = allData.filter(item => item.answer !== correctItem.answer);
        
        shuffle(pool);
        // Get unique answers only
        const unique = [...new Set(pool.map(i => i.answer))];
        return unique.slice(0, 3);
    }

    function loadQuestion() {
        // Reset UI
        feedbackBox.style.display = 'none';
        nextBtn.classList.add('hidden');
        idkBtn.classList.remove('hidden');
        optionsContainer.innerHTML = "";
        
        // Update Progress
        const pct = (currentIndex / currentQueue.length) * 100;
        progressBar.style.width = `${pct}%`;
        document.getElementById('score-indicator').innerText = `${currentIndex + 1} / ${currentQueue.length}`;

        if (currentIndex >= currentQueue.length) {
            endGame();
            return;
        }

        const currentItem = currentQueue[currentIndex];
        questionText.innerText = currentItem.question;

        // Generate Options & Shuffle Them
        const wrongAnswers = getDistractors(currentItem);
        let options = [...wrongAnswers, currentItem.answer];
        
        // IMPORTANT: Shuffle options EVERY time
        shuffle(options);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => handleAnswer(btn, opt, currentItem);
            optionsContainer.appendChild(btn);
        });
    }

    function handleAnswer(btn, selected, item) {
        disableAllButtons();
        feedbackBox.style.display = 'block';

        if (selected === item.answer) {
            // CORRECT
            btn.classList.add('correct');
            feedbackBox.className = 'feedback-box fb-correct';
            feedbackBox.innerHTML = `<strong>Correct!</strong> Great job! üéâ`;
        } else {
            // WRONG
            btn.classList.add('wrong');
            missedQueue.push(item);
            highlightCorrect(item.answer);
            
            feedbackBox.className = 'feedback-box fb-wrong';
            // Specific comment telling them the right one
            feedbackBox.innerHTML = `<strong>Not quite!</strong><br>The correct answer is: <strong>${item.answer}</strong>`;
        }
        nextBtn.classList.remove('hidden');
    }

    function handleIdk() {
        disableAllButtons();
        const item = currentQueue[currentIndex];
        missedQueue.push(item);
        highlightCorrect(item.answer);

        feedbackBox.style.display = 'block';
        feedbackBox.className = 'feedback-box fb-wrong'; // Use red style for attention
        feedbackBox.innerHTML = `<strong>That's okay!</strong><br>The correct answer is: <strong>${item.answer}</strong>`;

        nextBtn.classList.remove('hidden');
    }

    function disableAllButtons() {
        const btns = optionsContainer.querySelectorAll('button');
        btns.forEach(b => b.disabled = true);
        idkBtn.classList.add('hidden');
    }

    function highlightCorrect(correctAnswer) {
        const btns = optionsContainer.querySelectorAll('button');
        btns.forEach(b => {
            if (b.innerText === correctAnswer) b.classList.add('correct');
        });
    }

    function nextQuestion() {
        currentIndex++;
        loadQuestion();
    }

    function endGame() {
        quizScreen.classList.add('hidden');
        endScreen.classList.remove('hidden');

        const total = currentQueue.length;
        const missed = missedQueue.length;
        const correct = total - missed;

        document.getElementById('final-correct').innerText = correct;
        document.getElementById('final-wrong').innerText = missed;

        const reviewSection = document.getElementById('review-section');
        const homeBtn = document.getElementById('home-btn');

        if (missed > 0) {
            reviewSection.classList.remove('hidden');
            document.getElementById('end-title').innerText = "Good Practice! üìö";
        } else {
            reviewSection.classList.add('hidden');
            document.getElementById('end-title').innerText = "Perfect Score! üèÜ";
        }
    }
</script>

</body>
</html>
