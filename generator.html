<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Generator for Mobile</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 30px; max-width: 600px; margin: 0 auto; background: #f4f4f9; }
        h2 { margin-top: 0; color: #333; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        select, button { width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; }
        button { cursor: pointer; font-weight: bold; }
        #btn-generate { background-color: #2da44e; color: white; border: none; }
        #btn-copy { background-color: #0969da; color: white; border: none; display: none; }
        textarea { width: 100%; height: 200px; font-family: monospace; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
        .hint { font-size: 0.9rem; color: #666; margin-bottom: 10px; font-style: italic;}
    </style>
</head>
<body>

    <h2>ðŸ“± Mobile Update Helper</h2>

    <label>1. Which folder did you just update?</label>
    <select id="repoSelect">
        <option value="miriam">Miriam</option>
        <option value="alex">Alex</option>
        <option value="math">Math</option>
        <option value="books">Books</option>
        <option value="piano">Piano</option>
    </select>

    <button id="btn-generate" onclick="generateJson()">Generate List</button>

    <label>2. Copy this text:</label>
    <textarea id="output" readonly placeholder='(Click Generate first)'></textarea>

    <button id="btn-copy" onclick="copyToClipboard()">Copy to Clipboard</button>
    
    <p class="hint"><strong>Next Step:</strong> Go to the "files.json" file in that folder on GitHub, click Edit (pencil icon), delete everything, and paste this in.</p>

    <script>
        const USERNAME = "mr-chen-k12";

        function generateJson() {
            const repo = document.getElementById('repoSelect').value;
            const output = document.getElementById('output');
            const btnCopy = document.getElementById('btn-copy');

            output.value = "Scanning GitHub...";

            fetch(`https://api.github.com/repos/${USERNAME}/${repo}/contents/`)
                .then(res => res.json())
                .then(data => {
                    // Filter: HTML files only, exclude index.html and admin tools
                    const files = data
                        .filter(f => f.name.endsWith('.html') && !f.name.startsWith('index') && !f.name.startsWith('_'))
                        .map(f => f.name)
                        .sort();

                    // Output PURE JSON format (Array of strings)
                    output.value = JSON.stringify(files, null, 4);
                    btnCopy.style.display = "block";
                })
                .catch(err => {
                    output.value = "Error: " + err.message;
                });
        }

        function copyToClipboard() {
            const output = document.getElementById('output');
            output.select();
            document.execCommand('copy');
            alert("Copied! Now paste this into files.json");
        }
    </script>
</body>
</html>
